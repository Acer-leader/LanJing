<!DOCTYPE html>
<html dir="ltr" lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>控制面板|代码生成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <link href="__STATIC__/bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
    <link href="__STATIC__/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />
    <link type="text/css" href="__STATIC__/stylesheet/stylesheet.css" rel="stylesheet" media="screen" />
</head>
<body>
<div id="container">

    <div id="content">

        <div class="page-header">
            <div class="container-fluid">
                <div class="pull-right">
                    <button type="submit" form="form-set" data-toggle="tooltip" title="保存" class="btn btn-primary">
                        <i class="fa fa-save"></i>
                    </button>
                    <a href="{:url('table')}" data-toggle="tooltip" title="取消" class="btn btn-default">
                        <i class="fa fa-reply"></i>
                    </a>
                </div>
                <h1>代码生成</h1>
            </div>
        </div>

        <div class="container-fluid">
            <div class="panel panel-default">

                <div class="panel-body">
                    <form action="{:url('generate')}" method="post" enctype="multipart/form-data" id="form-set" class="form-horizontal">

                        <div class="tab-content">

                            <div class="form-group required">
                                <label class="col-sm-2 control-label" for="input-table">表名</label>
                                <div class="col-sm-10">
                                    <input type="text" name="table" value="" placeholder="表名(不含前缀)" id="input-table" class="form-control" />
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="input-table"></label>
                                <div class="col-sm-10">
                                    <a href="" id="button-info" class="btn btn-default pull-right">获取表信息</a>
                                </div>
                            </div>

                            <div class="form-group required">
                                <label class="col-sm-2 control-label" for="input-comment">标题</label>
                                <div class="col-sm-10">
                                    <input type="text" name="comment" value="" placeholder="标题" id="input-comment" class="form-control" />
                                </div>
                            </div>

                            <div class="form-group required">
                                <div class="col-sm-2 "></div>
                                <div class="col-sm-2">字段</div>
                                <div class="col-sm-2 ">描述</div>
                                <div class="col-sm-2 ">列表</div>
                                <div class="col-sm-2 ">列表排序</div>
                                <div class="col-sm-2 ">设置</div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {include file="common/footer" /}
</div>
<script type="text/javascript" src="__STATIC__/jquery/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="__STATIC__/bootstrap/js/bootstrap.min.js"></script>
<script src="__STATIC__/javascript/common.js" type="text/javascript"></script>

<script>

    var urlTableInfo = '{:url("info")}';
</script>

<!--获取表信息-->
<script>
    $(function() {
        $('#button-info').click(function(evt) {
            evt.preventDefault();// 阻止默认事件
            var url = urlTableInfo;
            var data = {
                table: $('#input-table').val()
            };
            // 发出ajax请求
            $.get(url, data, function(resp) {
                // 将表comment信息, 放入指定的位置
                $('#input-comment').val(resp.comment);

                // 拼凑成字段配置表单
                var html = '';
                // $.each jquery提供的遍历数组(对象)的方法
                // 参数1, 需要遍历的数组(对象)
                // 参数2, 遍历时执行的函数, i, 索引号, field, 每个遍历的数据
                $.each(resp.fields, function(i, field) {
                    html += '<div class="form-group">' +
                            '<div class="col-sm-2"></div>' +
                            '<div class="col-sm-2">' +
                            '<input type="text" name="fields['+i+'][name]" value="'+field.column_name+'" class="form-control" readonly/>' +
                            '</div>' +
                            '<div class="col-sm-2">' +
                            '<input type="text" name="fields['+i+'][comment]" value="'+field.column_comment+'" placeholder="ID" class="form-control"/>' +
                            '</div>' +
                            '<div class="col-sm-2">' +
                            '<input type="checkbox" name="fields['+i+'][is_list]" value="1" class="form-control" '+ (field.column_name=='create_time' || field.column_name=='update_time' ? '' : 'checked') + '/>' +
                            '</div>' +
                            '<div class="col-sm-2">' +
                            '<input type="checkbox" name="fields['+i+'][is_order]" value="1" class="form-control" '+ (field.column_name=='create_time' || field.column_name=='update_time' ? '' : 'checked') + '/>' +
                            '</div>' +
                            '<div class="col-sm-2">' +
                            '<input type="checkbox" name="fields['+i+'][is_set]" value="1" class="form-control" '+ (field.column_name=='create_time' || field.column_name=='update_time' || field.column_name=='id' ? '' : 'checked') + '/>' +
                            '</div>' +
                            '</div>';
                });
                // 追加到表单
                $('div.tab-content').append(html);
            }, 'json');
        });
    })
</script>
</body>
</html>